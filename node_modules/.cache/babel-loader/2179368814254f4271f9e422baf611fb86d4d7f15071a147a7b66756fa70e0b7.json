{"ast":null,"code":"var _regeneratorRuntime = require(\"/project/remora/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/project/remora/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _toConsumableArray = require(\"/project/remora/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _slicedToArray = require(\"/project/remora/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar ow = require('ow').default;\nvar util = require('util');\nvar zlib = require('zlib');\nvar PARSE_DATE_FIELDS_MAX_DEPTH = 3; // obj.data.someArrayField.[x].field\nvar PARSE_DATE_FIELDS_KEY_SUFFIX = 'At';\nvar NOT_FOUND_STATUS_CODE = 404;\nvar NOT_FOUND_TYPE = 'record-not-found';\nvar NOT_FOUND_ON_S3 = '<Code>NoSuchKey</Code>';\nvar MIN_GZIP_BYTES = 1024;\n\n/**\n * Returns object's 'data' property or throws if parameter is not an object,\n * or an object without a 'data' property.\n */\nfunction pluckData(obj) {\n  var isObject = !!obj && typeof obj === 'object';\n  if (isObject && typeof obj.data !== 'undefined') {\n    return obj.data;\n  }\n  throw new Error(\"Expected response object with a \\\"data\\\" property, but received: \".concat(obj));\n}\n\n/**\n * If given HTTP error has NOT_FOUND_STATUS_CODE status code then returns undefined.\n * Otherwise rethrows error.\n */\nfunction catchNotFoundOrThrow(err) {\n  var isNotFoundStatus = err.statusCode === NOT_FOUND_STATUS_CODE;\n  var isNotFoundMessage = err.type === NOT_FOUND_TYPE || err.message.includes(NOT_FOUND_ON_S3);\n  var isNotFoundError = isNotFoundStatus && isNotFoundMessage;\n  if (!isNotFoundError) throw err;\n}\n\n/**\n * Helper function that traverses JSON structure and parses fields such as modifiedAt or createdAt to dates.\n */\nfunction parseDateFields(input) {\n  var depth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  if (depth > PARSE_DATE_FIELDS_MAX_DEPTH) return input;\n  if (Array.isArray(input)) return input.map(function (child) {\n    return parseDateFields(child, depth + 1);\n  });\n  if (!input || typeof input !== 'object') return input;\n  return Object.entries(input).reduce(function (output, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      k = _ref2[0],\n      v = _ref2[1];\n    var isValObject = !!v && typeof v === 'object';\n    if (k.endsWith(PARSE_DATE_FIELDS_KEY_SUFFIX)) {\n      output[k] = v ? new Date(v) : v;\n    } else if (isValObject || Array.isArray(v)) {\n      output[k] = parseDateFields(v, depth + 1);\n    } else {\n      output[k] = v;\n    }\n    return output;\n  }, {});\n}\n\n/**\n * Helper function that converts array of webhooks to base64 string\n */\nfunction stringifyWebhooksToBase64(webhooks) {\n  if (!webhooks) return;\n  var webhooksJson = JSON.stringify(webhooks);\n  if (isNode()) {\n    return Buffer.from(webhooksJson, 'utf8').toString('base64');\n  }\n  var encoder = new TextEncoder();\n  var uint8Array = encoder.encode(webhooksJson);\n  return btoa(String.fromCharCode.apply(String, _toConsumableArray(uint8Array)));\n}\nvar gzipPromise;\nif (isNode()) gzipPromise = util.promisify(zlib.gzip);\n/**\n * @param {*} value\n */\nfunction maybeGzipValue(_x) {\n  return _maybeGzipValue.apply(this, arguments);\n}\n/**\n * @return {boolean}\n */\nfunction _maybeGzipValue() {\n  _maybeGzipValue = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(value) {\n    var areDataStringOrBuffer, areDataLargeEnough;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (isNode()) {\n            _context.next = 2;\n            break;\n          }\n          return _context.abrupt(\"return\", value);\n        case 2:\n          if (!(value == null)) {\n            _context.next = 4;\n            break;\n          }\n          return _context.abrupt(\"return\", value);\n        case 4:\n          // Request compression is not that important so let's\n          // skip it instead of throwing for unsupported types.\n          areDataStringOrBuffer = typeof value === 'string' || Buffer.isBuffer(value);\n          areDataLargeEnough = Buffer.byteLength(value) >= MIN_GZIP_BYTES;\n          if (!(areDataStringOrBuffer && areDataLargeEnough)) {\n            _context.next = 8;\n            break;\n          }\n          return _context.abrupt(\"return\", gzipPromise(value));\n        case 8:\n          return _context.abrupt(\"return\", value);\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return _maybeGzipValue.apply(this, arguments);\n}\nfunction isNode() {\n  return !!(typeof process !== 'undefined' && process.versions && process.versions.node);\n}\n\n/**\n * @param {*} value\n * @return {boolean}\n */\nfunction isBuffer(value) {\n  return ow.isValid(value, ow.any(ow.buffer, ow.arrayBuffer, ow.typedArray));\n}\n\n/**\n * @param {*} value\n * @return {boolean}\n */\nfunction isStream(value) {\n  return ow.isValid(value, ow.object.hasKeys('on', 'pipe'));\n}\nmodule.exports = {\n  isNode: isNode,\n  isBuffer: isBuffer,\n  isStream: isStream,\n  maybeGzipValue: maybeGzipValue,\n  stringifyWebhooksToBase64: stringifyWebhooksToBase64,\n  parseDateFields: parseDateFields,\n  catchNotFoundOrThrow: catchNotFoundOrThrow,\n  pluckData: pluckData\n};","map":{"version":3,"names":["ow","require","default","util","zlib","PARSE_DATE_FIELDS_MAX_DEPTH","PARSE_DATE_FIELDS_KEY_SUFFIX","NOT_FOUND_STATUS_CODE","NOT_FOUND_TYPE","NOT_FOUND_ON_S3","MIN_GZIP_BYTES","pluckData","obj","isObject","data","Error","concat","catchNotFoundOrThrow","err","isNotFoundStatus","statusCode","isNotFoundMessage","type","message","includes","isNotFoundError","parseDateFields","input","depth","arguments","length","undefined","Array","isArray","map","child","Object","entries","reduce","output","_ref","_ref2","_slicedToArray","k","v","isValObject","endsWith","Date","stringifyWebhooksToBase64","webhooks","webhooksJson","JSON","stringify","isNode","Buffer","from","toString","encoder","TextEncoder","uint8Array","encode","btoa","String","fromCharCode","apply","_toConsumableArray","gzipPromise","promisify","gzip","maybeGzipValue","_x","_maybeGzipValue","_asyncToGenerator","_regeneratorRuntime","mark","_callee","value","areDataStringOrBuffer","areDataLargeEnough","wrap","_callee$","_context","prev","next","abrupt","isBuffer","byteLength","stop","process","versions","node","isValid","any","buffer","arrayBuffer","typedArray","isStream","object","hasKeys","module","exports"],"sources":["/project/remora/node_modules/apify-client/src/utils.js"],"sourcesContent":["const ow = require('ow').default;\nconst util = require('util');\nconst zlib = require('zlib');\n\nconst PARSE_DATE_FIELDS_MAX_DEPTH = 3; // obj.data.someArrayField.[x].field\nconst PARSE_DATE_FIELDS_KEY_SUFFIX = 'At';\nconst NOT_FOUND_STATUS_CODE = 404;\nconst NOT_FOUND_TYPE = 'record-not-found';\nconst NOT_FOUND_ON_S3 = '<Code>NoSuchKey</Code>';\nconst MIN_GZIP_BYTES = 1024;\n\n/**\n * Returns object's 'data' property or throws if parameter is not an object,\n * or an object without a 'data' property.\n */\nfunction pluckData(obj) {\n    const isObject = !!obj && typeof obj === 'object';\n    if (isObject && typeof obj.data !== 'undefined') {\n        return obj.data;\n    }\n    throw new Error(`Expected response object with a \"data\" property, but received: ${obj}`);\n}\n\n/**\n * If given HTTP error has NOT_FOUND_STATUS_CODE status code then returns undefined.\n * Otherwise rethrows error.\n */\nfunction catchNotFoundOrThrow(err) {\n    const isNotFoundStatus = err.statusCode === NOT_FOUND_STATUS_CODE;\n    const isNotFoundMessage = err.type === NOT_FOUND_TYPE || err.message.includes(NOT_FOUND_ON_S3);\n    const isNotFoundError = isNotFoundStatus && isNotFoundMessage;\n    if (!isNotFoundError) throw err;\n}\n\n/**\n * Helper function that traverses JSON structure and parses fields such as modifiedAt or createdAt to dates.\n */\nfunction parseDateFields(input, depth = 0) {\n    if (depth > PARSE_DATE_FIELDS_MAX_DEPTH) return input;\n    if (Array.isArray(input)) return input.map((child) => parseDateFields(child, depth + 1));\n    if (!input || typeof input !== 'object') return input;\n\n    return Object.entries(input).reduce((output, [k, v]) => {\n        const isValObject = !!v && typeof v === 'object';\n        if (k.endsWith(PARSE_DATE_FIELDS_KEY_SUFFIX)) {\n            output[k] = v ? new Date(v) : v;\n        } else if (isValObject || Array.isArray(v)) {\n            output[k] = parseDateFields(v, depth + 1);\n        } else {\n            output[k] = v;\n        }\n        return output;\n    }, {});\n}\n\n/**\n * Helper function that converts array of webhooks to base64 string\n */\nfunction stringifyWebhooksToBase64(webhooks) {\n    if (!webhooks) return;\n    const webhooksJson = JSON.stringify(webhooks);\n    if (isNode()) {\n        return Buffer.from(webhooksJson, 'utf8').toString('base64');\n    }\n    const encoder = new TextEncoder();\n    const uint8Array = encoder.encode(webhooksJson);\n    return btoa(String.fromCharCode(...uint8Array));\n}\n\nlet gzipPromise;\nif (isNode()) gzipPromise = util.promisify(zlib.gzip);\n/**\n * @param {*} value\n */\nasync function maybeGzipValue(value) {\n    if (!isNode()) return value;\n    if (value == null) return value;\n\n    // Request compression is not that important so let's\n    // skip it instead of throwing for unsupported types.\n    const areDataStringOrBuffer = (typeof value === 'string') || Buffer.isBuffer(value);\n    const areDataLargeEnough = Buffer.byteLength(value) >= MIN_GZIP_BYTES;\n    if (areDataStringOrBuffer && areDataLargeEnough) {\n        return gzipPromise(value);\n    }\n    return value;\n}\n\n/**\n * @return {boolean}\n */\nfunction isNode() {\n    return !!(typeof process !== 'undefined' && process.versions && process.versions.node);\n}\n\n/**\n * @param {*} value\n * @return {boolean}\n */\nfunction isBuffer(value) {\n    return ow.isValid(value, ow.any(ow.buffer, ow.arrayBuffer, ow.typedArray));\n}\n\n/**\n * @param {*} value\n * @return {boolean}\n */\nfunction isStream(value) {\n    return ow.isValid(value, ow.object.hasKeys('on', 'pipe'));\n}\n\nmodule.exports = {\n    isNode,\n    isBuffer,\n    isStream,\n    maybeGzipValue,\n    stringifyWebhooksToBase64,\n    parseDateFields,\n    catchNotFoundOrThrow,\n    pluckData,\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}